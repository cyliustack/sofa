#!/bin/sh
function print_help()
{
    echo "sofa [--config yourconfig.cfg] command"
}
sudo sysctl -w kernel.perf_event_paranoid=-1

options=""
configFile="default.cfg"
while [[ 1 ]]; do
    case "$1" in
        "--help" )
            print_help
            exit 0
            ;;
        "-h" )
            print_help
            exit 0
            ;;
        "--config" )
            shift 
            configFile=$1
            ;;
        *)
            break
            ;;
    esac
    shift 1 # Remove the fisrt argument
done
args=$*
rm -f perf.data
#Communication Traces
tcpdump -w sofa.pcap & 
#Computation Traces
perf record -F 999 -a ${args} && pkill tcpdump
perf script > perf.script
echo "FSA Configuration File: ${configFile}"
echo "script source = $(dirname $0)"
$(dirname $0)/fsa ${configFile}
